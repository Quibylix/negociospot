generator client {
  provider = "prisma-client"
  output   = "../src/lib/prisma/generated/"
}

datasource db {
  provider = "postgresql"
}

model Profile {
  id        String     @id @default(uuid())
  email     String     @unique
  favorites Favorite[]
  reviews   Review[]

  createdRestaurants Restaurant[]

  administeredRestaurants RestaurantAdmin[]
  changeSuggestions       ChangeSuggestion[]
}

model Restaurant {
  id          Int     @id @default(autoincrement())
  name        String
  description String?
  schedule    String?

  slug String @unique

  logoImgUrl  String?
  coverImgUrl String?

  phone       String?
  whatsapp    String?
  socialMedia Json?

  address String?
  lat     Float?
  lng     Float?

  reviews     Review[]
  favoritedBy Favorite[]

  tags Tag[]

  createdBy   Profile? @relation(fields: [createdById], references: [id])
  createdById String?  @map("creatorId")

  menus             Menu[]
  administrators    RestaurantAdmin[]
  changeSuggestions ChangeSuggestion[]
}

model Menu {
  id           Int            @id @default(autoincrement())
  name         String
  restaurant   Restaurant     @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  restaurantId Int
  categories   MenuCategory[]
}

model MenuCategory {
  id        Int        @id @default(autoincrement())
  name      String
  menuItems MenuItem[]
  menu      Menu       @relation(fields: [menuId], references: [id], onDelete: Cascade)
  menuId    Int
}

model MenuItem {
  id          Int          @id @default(autoincrement())
  name        String
  description String?
  price       Int
  category    MenuCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId  Int
}

model Tag {
  id          Int          @id @default(autoincrement())
  name        String
  restaurants Restaurant[]
}

model Review {
  id           String     @id @default(uuid())
  rating       Int
  title        String
  comment      String
  restaurantId Int
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  profileId    String
  profile      Profile    @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model RestaurantAdmin {
  id           String     @id @default(uuid())
  profileId    String
  restaurantId Int
  profile      Profile    @relation(fields: [profileId], references: [id], onDelete: Cascade)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@unique([profileId, restaurantId])
}

model Favorite {
  profileId    String
  restaurantId Int
  profile      Profile    @relation(fields: [profileId], references: [id], onDelete: Cascade)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@id([profileId, restaurantId])
}

model ChangeSuggestion {
  id           String     @id @default(uuid())
  restaurantId Int
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  data         Json
  creatorId    String
  creator      Profile    @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  creationDate DateTime   @default(now())
}
